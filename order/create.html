<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta content="telephone=no" name="format-detection" />
    <title>VikingBuy</title>
    <link rel="stylesheet" href="../css/mui.min.css"/>
    <link rel="stylesheet" href="../css/vk-ui.css"/>
    <link rel="stylesheet" href="../css/style.css" />
    <script type="text/javascript" src="../js/public.js"></script>
    <script type="text/javascript" src="../js/config.js"></script>
    <script type="text/javascript" src="../js/mui.min.js"></script>
    <script type="text/javascript" src="../js/vk.js"></script>
    <script type="text/javascript" src="../js/app.js"></script>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
		<a class="nav-left vk-icon vk-icon-back mui-action-back"></a>
		<h1 class="mui-title">确认订单</h1>
	</header>
	<div class="mui-bar mui-bar-tab foot-nav m-comment-footer mui-clearfix">
		<div class="mui-pull-left pt-10 pl-15">
			<span>合计: <span class="text-main">8.888.888.888 ₫</span></span>
			<div class="f-12 text-gray mt-5">优惠: 88.888.888 ₫</div>
		</div>
		<a href="javascript:;" class="footer-btn mui-pull-right mui-btn mui-btn-primary">结算(1)</a>
	</div>
	<div class="mui-content m-order-submit">
		<ul class="mui-table-view">
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right">
					<span>收货人：海盗123</span>
					<span class="mui-pull-right">18623333333</span>
					<div class="u-tow-column">收货地址：重庆 南岸区 南坪街道 浪高凯悦国际商务大厦b座29-c1</div>
				</a>
			</li>
		</ul>
		<ul class="mui-table-view mt-10">
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right">
					<span class="f-12 text-gray">VikingBuy平台优惠券</span>
					<span class="text-gray mui-pull-right f-12">1张可用</span>
				</a>
			</li>
		</ul>
		<ul class="mui-table-view mt-10">
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right">
					<span class="f-12 text-gray">支付方式</span>
					<span class="text-gray mui-pull-right f-12">在线支付</span>
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right">
					<span class="f-12 text-gray">发票抬头</span>
					<span class="text-gray mui-pull-right f-12">不需要发票</span>
				</a>
			</li>
		</ul>
		<ul class="mt-10 mui-table-view m-flex rl-goods-list ">
			<li class="mui-table-view-cell">
				<span class="mr-15 vk-icon-shop"></span>
				<span>海盗云商旗舰店</span>
			</li>
			<li class="mui-table-view-cell flex good-list">
				<span class="vertical-box mr-10">
					<img src="../images/test/img.jpg" >
				</span>
				<div>
					<div class="u-tow-column">此处是商品标题最多两行如有超出请省略</div>
					<p class="text-hoar f-12 mui-ellipsis">此处是商品规格，如颜色尺码等信息~</p>
					<p class="text-main f-14">8.888.888.888 ₫ <span class="f-12 text-dark mui-pull-right">x1</span> </p>
				</div>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right">
					<span class="f-12 text-gray">店铺优惠券</span>
					<span class="text-gray mui-pull-right f-12">1张可用</span>
				</a>
			</li>
			<li class="mui-table-view-cell">
				<span class="mui-pull-right">共1件商品  小计：<span class="text-main">8.888.888.888 ₫</span></span>
			</li>
		</ul>
		<ul class="mt-10 mui-table-view m-flex rl-goods-list">
			<li class="mui-table-view-cell">
				<span class="mui-pull-left mr-15 vk-icon-shop "></span>
				<span>苹果授权店</span>
			</li>
			<li class="mui-table-view-cell flex good-list">
				<span class="vertical-box mr-10">
					<img src="../images/test/img.jpg" >
				</span>
				<div>
					<div class="u-tow-column">此处是商品标题最多两行如有超出请省略</div>
					<p class="text-hoar f-12 mui-ellipsis">此处是商品规格，如颜色尺码等信息~</p>
					<p class="text-main f-14">8.888.888.888 ₫ <span class="f-12 text-dark mui-pull-right">x1</span> </p>
				</div>
			</li>
			<li class="mui-table-view-cell good-list flex">
				<span class="vertical-box mr-10">
					<img src="../images/test/img.jpg" >
				</span>
				<div>
					<div class="u-tow-column">此处是商品标题最多两行如有超出请省略</div>
					<p class="text-hoar f-12 mui-ellipsis">此处是商品规格，如颜色尺码等信息~</p>
					<p class="text-main f-14">8.888.888.888 ₫ <span class="f-12 text-dark mui-pull-right">x1</span> </p>
				</div>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right">
					<span class="f-12 text-gray">店铺优惠券</span>
					<span class="text-gray mui-pull-right f-12">1张可用</span>
				</a>
			</li>
			<li class="mui-table-view-cell">
				<span class="mui-pull-right">共1件商品  小计：<span class="text-main">8.888.888.888 ₫</span></span>
			</li>
		</ul>
		<ul class="mui-table-view mt-10 mb-10">
			<li class="mui-table-view-cell">
				<div class="lh-24">订单总额<span class="mui-pull-right text-main">88.888.888 ₫</span></div>
				<div class="lh-24">VikingBuy平台优惠券<span class="mui-pull-right text-main">-88.888.88 ₫</span></div>
				<div class="lh-24">商家平台优惠券（2）<span class="mui-pull-right text-main">-88.888.88 ₫</span></div>
			</li>
		</ul>
	</div>
	<script type="text/javascript" src="../js/template.js"></script>
	<script type="text/javascript" src="../js/mui.lazyload.js"></script>
	<script type="text/javascript" src="../js/mui.lazyload.img.js"></script>
	<script type="text/html" id="cartContent">
		{{each skus as value}}
		<ul class="mui-table-view mt-10 js-cart-lists">
			<li class="mui-table-view-cell">
				<label class="mui-checkbox mui-solid-check">
					<input class="js-check-shop" checked="checked" type="checkbox" />
				</label>
				<span class="ml-30">洋货码头官方旗舰店</span>
			</li>
			<li class="mui-table-view-cell cart-good-list" data-id="{{value.sku_id}}">
				<label class="mui-checkbox mui-solid-check"><input class="js-check-item" checked="checked" type="checkbox" /></label>
				<div class="g-flex pl-30" data-href="../goods/detail.html" data-value="{{value.sku_id}}">
					<div class="vertical-box"><img src="../images/loadlazy.gif" data-lazyload="{{value._sku_.thumb}}" /></div>
					<div class="lh-18 ml-10 flex-full">
						<div class="mui-ellipsis-2">{{value._sku_.name}}</div>
						<div class="mui-ellipsis f-12 text-hoar mt-5">{{value._sku_.spec_show}}</div>
						<div class="mt-5 g-flex mui-clearfix">
							<span class="flex-full mui-ellipsis text-main"><span class="price">{{value._sku_.shop_price}}</span> ₫</span>
							<div class="mui-numbox mui-pull-right" data-numbox-min="1">
								<button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
								<input class="mui-numbox-input" data-num="{{value._sku_.number}}" type="number" value="{{value.number}}" />
								<button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
							</div>
						</div>
					</div>
				</div>
			</li>
		</ul>
		{{/each}}
	</script>
	<script>
		
		var ws;
		var order = {
			cartLists: null
		};
		
		//校验结算商品是否在会员购物车中
		function checkCartLists(val, ret){
			if(typeof val == 'string') val = val.split(",");
			for(var key in ret){
				var flog;
				for(var i = 0; i < val.length; i++){
					console.log(val[i])
					if(key == val[i]){
						flog = true;
					}
				}
				if(!flog){
					mui.toast("结算商品信息有误，请重新提交~");
					//设置购物车更新状态
			      	plus.storage.setItem("cartUpdateState", "true");
            		mui.later(function(){
            			ws.close();
            		}, 2000);
					return;
				}
			}
		}
		
		mui.plusReady(function(){
			
			ws = plus.webview.currentWebview();
			
			showCurrentWebview('pop-in');
			
			//获取购物车列表用于校验结算商品是否在购物车列表里
			app.ajax({
	            data : {
	                method: 'api.module.order.cart.lists',
	                token: plus.storage.getItem("token")
	            },
	            async: false,
	            success: function(data) {
	            	if(data.code == 200 && data.result){
	            		order.cartLists = data.result;
	            		//校验结算商品
	            		checkCartLists(ws.value, data.result.skus);
	            	}else{
	            		mui.toast("结算商品信息有误，请重新提交~");
	            		//设置购物车更新状态
			      		plus.storage.setItem("cartUpdateState", "true");
	            		mui.later(function(){
	            			ws.close();
	            		}, 2000);
	            	}
	            }
	      	});
			console.log(ws.value)
			
		})
	</script>
</body>
</html>